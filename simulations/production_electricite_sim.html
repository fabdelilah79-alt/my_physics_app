<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Production d'√âlectricit√© - Simulation Interactive</title>
    <style>
        :root {
            --primary: #2196F3;
            --success: #4CAF50;
            --warning: #FFC107;
            --bg-color: #f5f7fa;
            --panel-bg: #ffffff;
            --text-color: #2c3e50;
            --border-radius: 12px;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            margin: 0;
            padding: 20px;
            display: flex;
            flex-direction: column;
            align-items: center;
            min-height: 100vh;
            box-sizing: border-box;
        }

        header {
            width: 100%;
            max-width: 900px;
            margin-bottom: 15px;
        }

        h1 {
            color: white;
            font-size: 1.8rem;
            margin: 0;
            text-align: center;
            text-shadow: 0 2px 10px rgba(0,0,0,0.2);
        }

        #main-container {
            width: 100%;
            max-width: 900px;
            background: var(--panel-bg);
            border-radius: var(--border-radius);
            box-shadow: 0 8px 30px rgba(0,0,0,0.3);
            overflow: hidden;
            display: flex;
            flex-direction: column;
        }

        #canvas-wrapper {
            position: relative;
            background: linear-gradient(to bottom, #87ceeb 0%, #e0f7fa 100%);
            height: 500px;
            overflow: hidden;
        }

        canvas {
            display: block;
            width: 100%;
            height: 100%;
        }

        #instructions {
            background: #fff3cd;
            color: #856404;
            padding: 12px 20px;
            font-size: 0.95rem;
            border-bottom: 3px solid #ffc107;
            text-align: center;
            font-weight: 500;
        }

        #bottom-toolbar {
            background: #f8f9fa;
            padding: 15px;
            display: flex;
            justify-content: center;
            gap: 10px;
            flex-wrap: wrap;
            border-top: 2px solid #e9ecef;
        }

        .scene-btn {
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            min-width: 120px;
            padding: 12px 20px;
            border: 2px solid #dee2e6;
            border-radius: 8px;
            background: white;
            cursor: pointer;
            transition: all 0.3s;
            font-weight: 600;
            color: var(--text-color);
        }

        .scene-btn span {
            font-size: 2rem;
            margin-bottom: 5px;
        }

        .scene-btn:hover {
            background: #f8f9fa;
            transform: translateY(-2px);
            box-shadow: 0 4px 8px rgba(0,0,0,0.1);
        }

        .scene-btn.active {
            border-color: var(--primary);
            background: #e3f2fd;
            color: var(--primary);
            box-shadow: 0 4px 12px rgba(33, 150, 243, 0.3);
        }

        #info-panel {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 15px 20px;
            min-height: 60px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1.1rem;
            font-weight: 500;
            text-align: center;
        }

        .control-slider {
            position: absolute;
            bottom: 20px;
            left: 50%;
            transform: translateX(-50%);
            background: rgba(255,255,255,0.95);
            padding: 15px 25px;
            border-radius: 12px;
            box-shadow: 0 4px 15px rgba(0,0,0,0.2);
            display: none;
            align-items: center;
            gap: 15px;
        }

        .control-slider.active {
            display: flex;
        }

        input[type="range"] {
            width: 200px;
            height: 6px;
            -webkit-appearance: none;
            appearance: none;
            background: #ddd;
            outline: none;
            border-radius: 3px;
        }

        input[type="range"]::-webkit-slider-thumb {
            -webkit-appearance: none;
            appearance: none;
            width: 20px;
            height: 20px;
            background: var(--primary);
            cursor: pointer;
            border-radius: 50%;
            box-shadow: 0 2px 5px rgba(0,0,0,0.2);
        }

        input[type="range"]::-moz-range-thumb {
            width: 20px;
            height: 20px;
            background: var(--primary);
            cursor: pointer;
            border-radius: 50%;
            box-shadow: 0 2px 5px rgba(0,0,0,0.2);
            border: none;
        }

        .switch-btn {
            position: absolute;
            bottom: 30px;
            left: 50%;
            transform: translateX(-50%);
            background: #dc3545;
            color: white;
            border: none;
            padding: 15px 40px;
            border-radius: 25px;
            font-size: 1.1rem;
            font-weight: bold;
            cursor: pointer;
            box-shadow: 0 4px 15px rgba(220, 53, 69, 0.4);
            transition: all 0.3s;
            display: none;
        }

        .switch-btn.active {
            display: block;
        }

        .switch-btn:hover {
            background: #c82333;
            transform: translateX(-50%) translateY(-2px);
            box-shadow: 0 6px 20px rgba(220, 53, 69, 0.5);
        }

        .switch-btn.on {
            background: var(--success);
            box-shadow: 0 4px 15px rgba(76, 175, 80, 0.4);
        }

        .switch-btn.on:hover {
            background: #45a049;
            box-shadow: 0 6px 20px rgba(76, 175, 80, 0.5);
        }

        @media (max-width: 768px) {
            #canvas-wrapper {
                height: 350px;
            }
            .scene-btn {
                min-width: 100px;
                padding: 10px 15px;
                font-size: 0.85rem;
            }
            .scene-btn span {
                font-size: 1.5rem;
            }
            input[type="range"] {
                width: 150px;
            }
        }
    </style>
</head>
<body>

    <header>
        <h1>‚ö° Production d'√âlectricit√©</h1>
    </header>

    <div id="main-container">
        <div id="instructions">
            üëÜ Clique sur les boutons ci-dessous pour explorer chaque dispositif
        </div>

        <div id="canvas-wrapper">
            <canvas id="simCanvas"></canvas>

            <!-- Slider pour le panneau solaire -->
            <div class="control-slider" id="sun-slider">
                <span style="font-size: 1.5rem;">üåô</span>
                <input type="range" id="sunIntensity" min="0" max="100" value="0">
                <span style="font-size: 1.5rem;">‚òÄÔ∏è</span>
            </div>

            <!-- Bouton pour la pile -->
            <button class="switch-btn" id="circuit-switch">Circuit Ouvert ‚ö´</button>
        </div>

        <div id="info-panel">
            S√©lectionne un dispositif pour voir comment il produit de l'√©lectricit√©
        </div>

        <div id="bottom-toolbar">
            <button class="scene-btn active" onclick="changeScene('alternator')">
                <span>üîÑ</span>
                Alternateur
            </button>
            <button class="scene-btn" onclick="changeScene('solar')">
                <span>‚òÄÔ∏è</span>
                Panneau Solaire
            </button>
            <button class="scene-btn" onclick="changeScene('battery')">
                <span>üîã</span>
                Pile
            </button>
        </div>
    </div>

<script>
// ===== CONFIGURATION =====
const canvas = document.getElementById('simCanvas');
const ctx = canvas.getContext('2d');
let width, height;

let currentScene = 'alternator';
let rotorAngle = 0;
let isDragging = false;
let lastMouseAngle = 0;
let rotationSpeed = 0;
let sunIntensity = 0;
let circuitClosed = false;
let chemicalLevel = 100;
let lightIntensity = 0;
let fanRotation = 0;
let particles = [];
let time = 0;

// Messages informatifs
const messages = {
    alternator: {
        idle: "Fais glisser ton doigt sur l'aimant pour le faire tourner ! üîÑ",
        active: "Le mouvement de l'aimant cr√©e du courant √©lectrique ! ‚ö°"
    },
    solar: {
        night: "Pas de lumi√®re = Pas d'√©lectricit√© üåô",
        low: "Un peu de lumi√®re = Un peu d'√©lectricit√© ‚òÅÔ∏è",
        medium: "Plus de soleil = Plus d'√©lectricit√© üå§Ô∏è",
        high: "Plein soleil = Maximum d'√©lectricit√© ! ‚òÄÔ∏è"
    },
    battery: {
        open: "Le circuit est ouvert. L'√©lectricit√© ne circule pas ‚ö´",
        closed: "Le circuit est ferm√© ! L'√©nergie chimique se transforme en √©lectricit√© ‚ö°"
    }
};

// ===== INITIALISATION =====
function init() {
    resize();
    window.addEventListener('resize', resize);

    // Mouse events
    canvas.addEventListener('mousedown', handleMouseDown);
    canvas.addEventListener('mousemove', handleMouseMove);
    canvas.addEventListener('mouseup', handleMouseUp);
    canvas.addEventListener('mouseleave', handleMouseUp);

    // Touch events
    canvas.addEventListener('touchstart', (e) => {
        e.preventDefault();
        const touch = e.touches[0];
        handleMouseDown(touch);
    });
    canvas.addEventListener('touchmove', (e) => {
        e.preventDefault();
        const touch = e.touches[0];
        handleMouseMove(touch);
    });
    canvas.addEventListener('touchend', handleMouseUp);

    // Controls
    document.getElementById('sunIntensity').addEventListener('input', (e) => {
        sunIntensity = parseInt(e.target.value);
    });

    document.getElementById('circuit-switch').addEventListener('click', () => {
        circuitClosed = !circuitClosed;
        const btn = document.getElementById('circuit-switch');
        if (circuitClosed) {
            btn.textContent = 'Circuit Ferm√© ‚úÖ';
            btn.classList.add('on');
        } else {
            btn.textContent = 'Circuit Ouvert ‚ö´';
            btn.classList.remove('on');
        }
    });

    requestAnimationFrame(loop);
}

function resize() {
    const wrapper = document.getElementById('canvas-wrapper');
    width = wrapper.clientWidth;
    height = wrapper.clientHeight;
    canvas.width = width;
    canvas.height = height;
}

// ===== SC√àNE =====
function changeScene(scene) {
    currentScene = scene;

    // Reset states
    rotationSpeed = 0;
    sunIntensity = 0;
    circuitClosed = false;
    chemicalLevel = 100;
    particles = [];

    // Update UI
    document.querySelectorAll('.scene-btn').forEach(btn => btn.classList.remove('active'));
    event.currentTarget.classList.add('active');

    // Show/hide controls
    document.getElementById('sun-slider').classList.remove('active');
    document.getElementById('circuit-switch').classList.remove('active');

    if (scene === 'solar') {
        document.getElementById('sun-slider').classList.add('active');
        document.getElementById('sunIntensity').value = 0;
    } else if (scene === 'battery') {
        document.getElementById('circuit-switch').classList.add('active');
        document.getElementById('circuit-switch').textContent = 'Circuit Ouvert ‚ö´';
        document.getElementById('circuit-switch').classList.remove('on');
    }

    updateInfoPanel();
}

function updateInfoPanel() {
    const panel = document.getElementById('info-panel');

    if (currentScene === 'alternator') {
        panel.textContent = Math.abs(rotationSpeed) > 0.5 ? messages.alternator.active : messages.alternator.idle;
    } else if (currentScene === 'solar') {
        if (sunIntensity < 20) panel.textContent = messages.solar.night;
        else if (sunIntensity < 50) panel.textContent = messages.solar.low;
        else if (sunIntensity < 80) panel.textContent = messages.solar.medium;
        else panel.textContent = messages.solar.high;
    } else if (currentScene === 'battery') {
        panel.textContent = circuitClosed ? messages.battery.closed : messages.battery.open;
    }
}

// ===== INPUT HANDLERS =====
function handleMouseDown(e) {
    if (currentScene !== 'alternator') return;

    const rect = canvas.getBoundingClientRect();
    const mx = (e.clientX || e.pageX) - rect.left;
    const my = (e.clientY || e.pageY) - rect.top;

    const centerX = width / 2;
    const centerY = height / 2;
    const dx = mx - centerX;
    const dy = my - centerY;
    const dist = Math.sqrt(dx * dx + dy * dy);

    if (dist < 100) {
        isDragging = true;
        lastMouseAngle = Math.atan2(dy, dx);
    }
}

function handleMouseMove(e) {
    if (!isDragging || currentScene !== 'alternator') return;

    const rect = canvas.getBoundingClientRect();
    const mx = (e.clientX || e.pageX) - rect.left;
    const my = (e.clientY || e.pageY) - rect.top;

    const centerX = width / 2;
    const centerY = height / 2;
    const dx = mx - centerX;
    const dy = my - centerY;
    const currentAngle = Math.atan2(dy, dx);

    let angleDiff = currentAngle - lastMouseAngle;

    // Handle angle wraparound
    if (angleDiff > Math.PI) angleDiff -= 2 * Math.PI;
    if (angleDiff < -Math.PI) angleDiff += 2 * Math.PI;

    rotationSpeed = angleDiff * 0.8;
    lastMouseAngle = currentAngle;
}

function handleMouseUp() {
    isDragging = false;
}

// ===== PARTICLES =====
class Particle {
    constructor(x, y, type) {
        this.x = x;
        this.y = y;
        this.type = type;
        this.life = 1.0;
        this.size = Math.random() * 3 + 2;
        this.vx = (Math.random() - 0.5) * 2;
        this.vy = (Math.random() - 0.5) * 2;

        if (type === 'electron') {
            this.color = '#ffeb3b';
        } else if (type === 'light') {
            this.color = '#fff';
            this.size = Math.random() * 4 + 3;
        }
    }

    update() {
        this.x += this.vx;
        this.y += this.vy;
        this.life -= 0.02;
    }

    draw() {
        ctx.globalAlpha = this.life;
        ctx.fillStyle = this.color;
        ctx.beginPath();
        ctx.arc(this.x, this.y, this.size, 0, Math.PI * 2);
        ctx.fill();
        ctx.globalAlpha = 1;
    }
}

// ===== DRAW FUNCTIONS =====

function drawAlternator() {
    const centerX = width / 2;
    const centerY = height / 2;

    // Stator (Bobine fixe)
    ctx.strokeStyle = '#8B4513';
    ctx.lineWidth = 20;
    ctx.beginPath();
    ctx.arc(centerX, centerY, 120, 0, Math.PI * 2);
    ctx.stroke();

    // Bobine wires
    ctx.strokeStyle = '#D2691E';
    ctx.lineWidth = 3;
    for (let i = 0; i < 8; i++) {
        const angle = (Math.PI * 2 * i) / 8;
        const x1 = centerX + Math.cos(angle) * 100;
        const y1 = centerY + Math.sin(angle) * 100;
        const x2 = centerX + Math.cos(angle) * 140;
        const y2 = centerY + Math.sin(angle) * 140;
        ctx.beginPath();
        ctx.moveTo(x1, y1);
        ctx.lineTo(x2, y2);
        ctx.stroke();
    }

    // Label Stator
    ctx.fillStyle = '#333';
    ctx.font = 'bold 16px Arial';
    ctx.textAlign = 'center';
    ctx.fillText('Stator (Bobine)', centerX, centerY + 180);

    // Rotor (Aimant tournant)
    ctx.save();
    ctx.translate(centerX, centerY);
    ctx.rotate(rotorAngle);

    // Aimant
    const gradient = ctx.createLinearGradient(-50, -50, 50, 50);
    gradient.addColorStop(0, '#FF4444');
    gradient.addColorStop(0.5, '#CCCCCC');
    gradient.addColorStop(1, '#4444FF');

    ctx.fillStyle = gradient;
    ctx.fillRect(-50, -50, 100, 100);

    // N et S
    ctx.fillStyle = 'white';
    ctx.font = 'bold 24px Arial';
    ctx.fillText('N', -25, 0);
    ctx.fillText('S', 25, 0);

    ctx.restore();

    // Label Rotor
    ctx.fillStyle = '#333';
    ctx.fillText('Rotor (Aimant)', centerX, centerY - 180);

    // Lampe
    const lampX = width - 100;
    const lampY = 100;
    lightIntensity = Math.min(1, Math.abs(rotationSpeed) * 2);

    // Fil conducteur
    ctx.strokeStyle = '#666';
    ctx.lineWidth = 3;
    ctx.beginPath();
    ctx.moveTo(centerX + 120, centerY);
    ctx.lineTo(lampX, lampY + 30);
    ctx.stroke();

    // Base lampe
    ctx.fillStyle = '#999';
    ctx.fillRect(lampX - 20, lampY + 30, 40, 40);

    // Ampoule
    ctx.fillStyle = lightIntensity > 0.1 ? `rgba(255, 255, 150, ${lightIntensity})` : '#666';
    ctx.beginPath();
    ctx.arc(lampX, lampY, 25, 0, Math.PI * 2);
    ctx.fill();

    // Halo
    if (lightIntensity > 0.1) {
        const haloGrad = ctx.createRadialGradient(lampX, lampY, 10, lampX, lampY, 50);
        haloGrad.addColorStop(0, `rgba(255, 255, 200, ${lightIntensity * 0.5})`);
        haloGrad.addColorStop(1, 'rgba(255, 255, 200, 0)');
        ctx.fillStyle = haloGrad;
        ctx.fillRect(lampX - 50, lampY - 50, 100, 100);
    }

    // Electrons
    if (Math.abs(rotationSpeed) > 0.1 && Math.random() > 0.7) {
        particles.push(new Particle(centerX + 120, centerY, 'electron'));
    }
}

function drawSolarPanel() {
    const panelX = width / 2 - 150;
    const panelY = height / 2 - 50;

    // Soleil
    const sunX = 150;
    const sunY = 100;
    const sunSize = 40 + (sunIntensity / 100) * 20;

    const sunGrad = ctx.createRadialGradient(sunX, sunY, 10, sunX, sunY, sunSize);
    sunGrad.addColorStop(0, `rgba(255, 220, 0, ${sunIntensity / 100})`);
    sunGrad.addColorStop(0.5, `rgba(255, 200, 0, ${sunIntensity / 150})`);
    sunGrad.addColorStop(1, `rgba(255, 180, 0, 0)`);

    ctx.fillStyle = sunGrad;
    ctx.beginPath();
    ctx.arc(sunX, sunY, sunSize, 0, Math.PI * 2);
    ctx.fill();

    // Rayons
    if (sunIntensity > 20) {
        ctx.strokeStyle = `rgba(255, 220, 0, ${sunIntensity / 200})`;
        ctx.lineWidth = 2;
        for (let i = 0; i < 8; i++) {
            const angle = (Math.PI * 2 * i) / 8 + time * 0.01;
            ctx.beginPath();
            ctx.moveTo(sunX + Math.cos(angle) * sunSize, sunY + Math.sin(angle) * sunSize);
            ctx.lineTo(sunX + Math.cos(angle) * (sunSize + 15), sunY + Math.sin(angle) * (sunSize + 15));
            ctx.stroke();
        }
    }

    // Panneau solaire
    ctx.fillStyle = '#1a237e';
    ctx.fillRect(panelX, panelY, 150, 100);

    // Cellules
    ctx.strokeStyle = '#444';
    ctx.lineWidth = 2;
    for (let i = 0; i < 3; i++) {
        for (let j = 0; j < 3; j++) {
            ctx.strokeRect(panelX + 5 + i * 47, panelY + 5 + j * 30, 42, 25);
        }
    }

    // Reflet
    if (sunIntensity > 0) {
        ctx.fillStyle = `rgba(135, 206, 250, ${sunIntensity / 300})`;
        ctx.fillRect(panelX, panelY, 150, 100);
    }

    ctx.fillStyle = '#333';
    ctx.font = 'bold 14px Arial';
    ctx.textAlign = 'center';
    ctx.fillText('Panneau Photovolta√Øque', panelX + 75, panelY + 120);

    // Ventilateur
    const fanX = width - 150;
    const fanY = height / 2;

    // Support
    ctx.fillStyle = '#666';
    ctx.fillRect(fanX - 5, fanY, 10, 100);
    ctx.fillRect(fanX - 30, fanY + 100, 60, 10);

    // Pale rotation
    fanRotation += (sunIntensity / 100) * 0.2;

    ctx.save();
    ctx.translate(fanX, fanY);
    ctx.rotate(fanRotation);

    // Pales
    ctx.fillStyle = '#aaa';
    for (let i = 0; i < 3; i++) {
        ctx.save();
        ctx.rotate((Math.PI * 2 * i) / 3);
        ctx.fillRect(-5, -60, 10, 60);
        ctx.restore();
    }

    // Centre
    ctx.fillStyle = '#444';
    ctx.beginPath();
    ctx.arc(0, 0, 10, 0, Math.PI * 2);
    ctx.fill();

    ctx.restore();

    // Fil
    ctx.strokeStyle = '#666';
    ctx.lineWidth = 3;
    ctx.beginPath();
    ctx.moveTo(panelX + 150, panelY + 50);
    ctx.lineTo(fanX, fanY);
    ctx.stroke();

    // Electrons
    if (sunIntensity > 20 && Math.random() > 0.8) {
        particles.push(new Particle(panelX + 150, panelY + 50, 'electron'));
    }
}

function drawBattery() {
    const batteryX = width / 2 - 100;
    const batteryY = height / 2 - 80;

    // Pile externe
    ctx.fillStyle = '#FFD700';
    ctx.fillRect(batteryX, batteryY, 80, 120);

    // + et -
    ctx.fillStyle = '#333';
    ctx.font = 'bold 24px Arial';
    ctx.textAlign = 'center';
    ctx.fillText('+', batteryX + 20, batteryY - 10);
    ctx.fillText('-', batteryX + 60, batteryY + 145);

    // Int√©rieur (coupe)
    ctx.fillStyle = 'rgba(255,255,255,0.3)';
    ctx.fillRect(batteryX + 10, batteryY + 10, 60, 100);

    // Niveau chimique
    const chemicalHeight = (chemicalLevel / 100) * 90;
    const chemicalGrad = ctx.createLinearGradient(0, batteryY + 110 - chemicalHeight, 0, batteryY + 110);
    chemicalGrad.addColorStop(0, '#00BCD4');
    chemicalGrad.addColorStop(1, '#0097A7');

    ctx.fillStyle = chemicalGrad;
    ctx.fillRect(batteryX + 15, batteryY + 110 - chemicalHeight, 50, chemicalHeight);

    // Label
    ctx.fillStyle = '#333';
    ctx.font = 'bold 14px Arial';
    ctx.fillText('Pile', batteryX + 40, batteryY + 145);
    ctx.font = '11px Arial';
    ctx.fillText(`√ânergie: ${Math.round(chemicalLevel)}%`, batteryX + 40, batteryY + 160);

    // Interrupteur (visuel)
    const switchX = width / 2 + 50;
    const switchY = batteryY + 20;

    ctx.strokeStyle = '#666';
    ctx.lineWidth = 3;
    ctx.beginPath();
    ctx.moveTo(batteryX + 80, batteryY + 20);
    ctx.lineTo(switchX, switchY);
    ctx.stroke();

    // Switch symbol
    ctx.strokeStyle = circuitClosed ? '#4CAF50' : '#dc3545';
    ctx.lineWidth = 4;
    ctx.beginPath();
    ctx.arc(switchX, switchY, 15, 0, Math.PI * 2);
    ctx.stroke();

    if (!circuitClosed) {
        ctx.beginPath();
        ctx.moveTo(switchX, switchY - 10);
        ctx.lineTo(switchX + 10, switchY - 20);
        ctx.stroke();
    }

    // Lampe
    const lampX = width / 2 + 150;
    const lampY = batteryY + 60;

    ctx.strokeStyle = '#666';
    ctx.lineWidth = 3;
    ctx.beginPath();
    ctx.moveTo(switchX, switchY);
    ctx.lineTo(lampX, lampY - 30);
    ctx.stroke();

    ctx.beginPath();
    ctx.moveTo(lampX, lampY + 30);
    ctx.lineTo(batteryX + 80, batteryY + 100);
    ctx.stroke();

    // Lampe
    lightIntensity = circuitClosed ? 1 : 0;

    ctx.fillStyle = '#999';
    ctx.fillRect(lampX - 20, lampY + 30, 40, 40);

    ctx.fillStyle = circuitClosed ? '#FFFF96' : '#666';
    ctx.beginPath();
    ctx.arc(lampX, lampY, 25, 0, Math.PI * 2);
    ctx.fill();

    if (circuitClosed) {
        const haloGrad = ctx.createRadialGradient(lampX, lampY, 10, lampX, lampY, 50);
        haloGrad.addColorStop(0, 'rgba(255, 255, 200, 0.8)');
        haloGrad.addColorStop(1, 'rgba(255, 255, 200, 0)');
        ctx.fillStyle = haloGrad;
        ctx.fillRect(lampX - 50, lampY - 50, 100, 100);

        // D√©charge chimique
        if (chemicalLevel > 0) {
            chemicalLevel -= 0.05;
        }

        // Electrons
        if (Math.random() > 0.7) {
            particles.push(new Particle(batteryX + 80, batteryY + 20, 'electron'));
        }
    }
}

// ===== MAIN LOOP =====
function loop() {
    time++;

    // Clear
    ctx.clearRect(0, 0, width, height);

    // Background gradient
    const bgGrad = ctx.createLinearGradient(0, 0, 0, height);
    if (currentScene === 'solar') {
        const intensity = sunIntensity / 100;
        bgGrad.addColorStop(0, `rgb(${135 * intensity}, ${206 * intensity}, ${250 * (0.5 + intensity * 0.5)})`);
        bgGrad.addColorStop(1, `rgb(${224 * intensity}, ${247 * intensity}, ${250 * (0.5 + intensity * 0.5)})`);
    } else {
        bgGrad.addColorStop(0, '#87ceeb');
        bgGrad.addColorStop(1, '#e0f7fa');
    }
    ctx.fillStyle = bgGrad;
    ctx.fillRect(0, 0, width, height);

    // Draw current scene
    if (currentScene === 'alternator') {
        if (!isDragging) {
            rotationSpeed *= 0.95;
        }
        rotorAngle += rotationSpeed;
        drawAlternator();
    } else if (currentScene === 'solar') {
        drawSolarPanel();
    } else if (currentScene === 'battery') {
        drawBattery();
    }

    // Update and draw particles
    for (let i = particles.length - 1; i >= 0; i--) {
        particles[i].update();
        particles[i].draw();
        if (particles[i].life <= 0) {
            particles.splice(i, 1);
        }
    }

    // Update info panel
    if (time % 30 === 0) {
        updateInfoPanel();
    }

    requestAnimationFrame(loop);
}

// Start
window.onload = init;
</script>

</body>
</html>
